var ImgViewer=function(){function kr(){var n=_ge("hp_cellCenter");return n&&n.className.indexOf("hp_hd")!=-1&&hp_defined(g_img.hdurl)&&g_img.url==g_img.hdurl?!0:!1}function ir(n,t,i){var r=sj_gx(),u=hp_pushparams(["format=js","idx="+n,"n="+t,"nc="+sb_gt(),"pid=hp"]),f;_w.g_vidOn&&u.push("video=1"),f="/HPImageArchive.aspx?"+u.join("&"),r.open("GET",f,!0),sj_be(r,"readystatechange",function(){r.readyState==4&&r.status==200&&(c=gr(r.responseText),nt=Math.min(oi,n+(c&&c.images&&c.images.length)||0),i(!!c))}),r.send(null)}function gr(n){if(typeof n!="string"||!n)return null;if(_w.JSON&&_w.JSON.parse)try{return _w.JSON.parse(n)}catch(t){}try{return new Function("return "+n)()}catch(t){return null}}function tu(){for(var n=0,t=c.images.length;n<t;n++)dt(n,n)}function dt(t,i){var e;if(n[t]=c.images[i]||null,or){var r=Math.max(screen.height,screen.width),u=Math.min(screen.height,screen.width),f="//"+window.location.host+"/iod/";n[t].url=f+r+"/"+u+"/"+n[t].fullstartdate,n[t].portraiturl=f+u+"/"+r+"/"+n[t].fullstartdate}else br&&(e="_1920x1080.jpg",n[t].url=n[t].urlbase+e)}function ur(i){var r=t+1;lt[r]||r>=oi?et():n[r]?ki(r):ir(r,1,function(n){n?(dt(r,0),ki(r)):et(),typeof i=="function"&&i(n)})}function pr(){var n=g_prefetch;n&&(n.Im&&fu(n.Im),n.Vid&&uu(n.Vid))}function fu(n){var t=new Image;t.onload=function(){var t=sj_cook.get("_SS","bIm");t=t&&t.length>=3?t.substring(t.length-3)+n.hash:n.hash,sj_cook.set("_SS","bIm",t,0,"/")},t.src=n[ft]}function uu(n){var t=sj_ce("video","prefVid"),i,u,r;try{t.setAttribute("preload","auto")}catch(f){}for(t.width=956,t.height=512,i=0,u=n.length;i<u;i++)r=sj_ce("source"),r.src=n[i][2],r.type=n[i][1],t.appendChild(r);t.style.display="none",sj_b.appendChild(t),sj_be(t,"canplaythrough",function(){var n=_ge("prefVid");n&&sj_b.removeChild(n)})}function ki(t){if(!lt[t]){et();var i=n[t],r=new Image;r.onload=function(){sj_evt.fire("onHPIVImg"+t,t),lt[t]=1},r.src=i.pano?i.pano.image:_w.g_vidOn&&i.vid?i.vid.image:i[ft]}}function kt(n){t==0||w||(t--,wi(),ai(1,t)),typeof n!==s&&n&&sj_pd(n)}function bt(n){if(t<nt-1&&!w&&!ei){var i=t+1;ei=1,lt[i]||dr(),sj_evt.bind("onHPIVImg"+i,ou,1),ai(-1,i)}typeof n!==s&&n&&sj_pd(n)}function ou(n){n[1]==t+1&&(t++,ei=0,wi())}function et(){var r=n[t],u=r[tr]=="1"?tt:ot,o,h,c;r.vid&&(o=r.vid.dark,_ge("sh_pl").parentNode.className=o?"sh_pll":"sh_pld",_ge("sh_ps").parentNode.className=o?"sh_psl":"sh_psd",u=o?tt:ot),h=u+"dis",p.className=u,c=p.href===st?ui:ii,p.style.cursor=c,i.firstChild.className=t===nt-1?h:u,f.firstChild.className=t==0?h:u,i.title=v.previous,f.title=v.next,sj_evt.fire("updateHpImg",r),e&&typeof hpWall!==s&&(r.wp&&!r.vid?(hpWall.enabled=!0,hpWall.hash=r.hsh,e.firstChild.className=u,e.title=v.walls,e.style.cursor=ii):(hpWall.hash="",hpWall.enabled=!1,hpWall.tB(0),e.firstChild.className=h,e.title=v.walle,e.style.cursor=ui))}function dr(){i.title=v.loading}function wi(){w=1,gt&&clearTimeout(gt),ur(),a&&a.disable();var n=_ge("vid");if(_w.g_vidOn&&(VM.InFoc=0,n&&n.style.opacity!="0"&&(n.onended=null,VM.hideControls())),r&&r.style.opacity!="0"){_ge("panoControls").style.visibility=at,u.style.backgroundImage="url()",ut.down(function(){u.removeChild(r),ut=r=null,pi()});return}pt.down(pi)}function pi(){var s;u.style.display=it;var i=n[t],r=_ge("vid"),e=_ge("sc_mktb"),o=n[t].fullstartdate,h=o.substr(0,8)+"_"+o.substr(8,4),f;if(r&&_w.g_vidOn&&VM&&(r.pause&&!r.paused&&r.pause(),r.style.display="none",sj_so(r,0),VM.Loaded=!1,_w.g_vid=null,i.vid)){if(wt(i.vid.caption,i.copyrightlink),f="url('"+i.vid.image+"')",u.style.backgroundImage=f,u.style.display=gi,i.vid.loop){r.onended=VM.play;try{r.setAttribute("loop","true")}catch(c){}}else{r.onended=VM.end;try{r.removeAttribute("loop")}catch(c){}}_w.g_vid=i.vid.sources,VM.InFoc=1,VM.sa_vid_ld(wr),pt.up(vi)}i.pano&&ni(i.pano,!1),i.vid||(wt(i.copyright,i.copyrightlink),f=i[ft],i.pano&&(f=i.pano.image),f="url('"+f+"')",u.style.backgroundImage=f,u.style.filter=sb_i8l?"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i[ft]+"', sizingMethod='scale') progid:DXImageTransform.Microsoft.Alpha(opacity=0);":"",u.style.display=gi,pt.up(vi)),sj_evt.fire("onHPImgViewerNavigation",h),e&&(s=_ge("hp_husb"),e.style.display=!!s||i.vid||i.pano?"none":"block")}function wt(n,t){var i=typeof t==s||t==""||t==st,r=_ge("musCard");r?p.href=st:(p.title=n,p.href=i?st:t,p.style.cursor=i?ui:ii)}function wr(){var n=_ge("vid");n&&VM&&VM.InFoc&&(VM._autoPlay===!1?VM.pause():VM.play(),VM.Loaded=!0,n.style.display="block",sj_so(n,100))}function vi(){var f,o,l,r,v,h,y,b,i,e,u,c;if(w=0,f=n[t],_w.g_hot&&(!f.pano||f.pano.hs===!0)){for(o=f.hs,i=0,c=o.length;i<c;i++){if(i>=o.length){typeof g_triggerElems!==s&&(g_triggerElems[i].isHotSpotDisabled=!0);continue}else typeof g_triggerElems!==s&&(g_triggerElems[i].isHotSpotDisabled=!1);l=i+1,r=o[i],v=_ge("sc_hst"+l),v.style.left=r.locx+"%",v.style.top=r.locy+"%",h=_ge("sc_hs"+l),h.href=r.link,h.firstChild.innerHTML=r.desc,h.firstChild.nextSibling.innerHTML=r.query}a&&a.intro(1)}var k=_ge("hp_pgNav"),d=k?2:0,p=_ge("hp_pgbar");if(p)for(y=p.getElementsByTagName("h3"),b=f.msg,i=0,c=y.length;i<c;i++){if(e=b[i],!e)break;if(u=y[i+d],!u)break;u.parentNode.id!==ar&&(u.innerHTML=e.title,u.nextSibling.innerHTML=e.text,u.nextSibling.href=e.link)}}function ai(n){if(typeof hpl!==s){if(hpl&&(y=hpl),y&&y.ssd){var i=y.ssd,r=new Date(parseInt(i.substr(0,4),10),i.substr(4,2)-1,parseInt(i.substr(6,2),10)+n);y.ssd=r.getFullYear().toString()+li(r.getMonth()+1)+li(r.getDate())+"_"+i.substr(9,4)}y&&(hpl=y)}}function li(n){return(n<10?"0":"")+n}function eu(n){var t,f,i;if(wt(n.cap,n.caplink),n.spots)for(t=0,f=n.spots.length;t<f;t++)i=n.spots[t],Pano.CreateHotspot(i[0],i[1],i[2]);w=1,r.style.opacity=0,u.style.opacity=1,r.style.visibility=h,ut.up(function(){var t,i;_ge("panoControls").style.visibility=h,sj_evt.bind(si,function(){Pano.StopAnimation()}),t=!0,n.an===!0&&(i=sj_cook&&sj_cook.get("SRCHHPGUSR","HAP"),i&&i!="0"&&(t=!1),t&&(gt=sb_st(function(){Pano.IdleAnimate()},500))),w=0})}function o(n){return sj_ce(iu,n)}function vr(){var c,i,h,s,e,nt,n,k;if(_ge("panoDiv")||(r=o("panoDiv"),u.appendChild(r),ut=_anim.fadeE(r,fr)),c=_ge("hp_ctrls"),c&&!_ge("panoControls")){var p=o("panoLeft"),y=o("panoRight"),v=o("panoUp"),a=o("panoDown"),l=o("panoZoomIn"),w=o("panoZoomOut"),f=o("panoPosition");f.appendChild(v),f.appendChild(p),f.appendChild(y),f.appendChild(a),i=o("panoControlSet"),i.appendChild(w),i.appendChild(f),i.appendChild(l),h=o("panoControls"),h.appendChild(i),s=[p,y,v,a,l,w];function t(n,t){Pano.SetCameraFidelity(!1),fi=!1,d(n,t)}function d(n,t){fi==!1?(Pano.MovePano(n,t),sb_st(sj_wf(d,n,t),25)):Pano.SetCameraFidelity(!0)}function g(){fi=!0}for(e=0,nt=s.length;e<nt;e++)sj_be(s[e],yi,g);sj_be(_d,yi,g),sj_be(l,b,sj_wf(t,"z",1)),sj_be(w,b,sj_wf(t,"z",-1)),n=.05,k=_G&&_G.RTL===!0,sj_be(p,b,sj_wf(t,"x",k?-n:n)),sj_be(y,b,sj_wf(t,"x",k?n:-n)),sj_be(v,b,sj_wf(t,"y",n)),sj_be(a,b,sj_wf(t,"y",-n)),sj_be(_w,"blur",Pano.StopAnimation),c.appendChild(h)}}function ni(n,t){function i(){vr(),n.hs===!1&&a&&a.disable();var t=_w.location.search.indexOf("debug=1")!=-1,i="?h="+_w.location.host,u=sb_gt();Pano.InitializePano(n.url,r,function(){eu(n),_w.hp_llog&&hp_llog("Pano",sb_gt()-u)},t,n.pos,n.maxfov,i),sj_evt.fire("onPanoComplete")}_H.startTm&&t&&_w.hp_llog&&hp_llog("PanoStart",sb_gt()-_H.startTm),typeof Pano===s?(sj_evt.bind("onPanoLoad",function(){i()}),sj_jb("HomepagePano_c"),sj_be(_w,"resize",function(){r&&typeof Pano!==s&&typeof Pano.SetViewportSize===lr&&Pano.SetViewportSize(r.offsetWidth,r.offsetHeight)})):i()}function vt(){sj_evt&&sj_evt.fire(si)}function cr(){var n=sj_cook&&sj_cook.get("_UR","D"),t=sj_cook&&sj_cook.get("_UR","DHP");return n&&n!="0"&&n!="1"||t&&t!="0"?!0:!1}function hr(){var t="isHomepage",i="http://"+_d.domain+"/",r=i.replace(/www\./i,""),n=sr();return n?ci(n,t,i)||ci(n,t,r):0}function ci(n,t,i){try{return n[t](i)}catch(r){return 0}}function sr(){var n=_ge("dhp_detect");return n||(n=sj_ce("span","dhp_detect"),n.style.behavior="url(#default#homepage)",sj_b.appendChild(n)),n}function hi(){if(cr()||hr())l&&(l.style.display=it),ti&&(ti.style.display=it);else if(ht&&l&&l.style.display!=it){var n=l.offsetLeft;(!ct||ct&&ct.clientWidth<rr)&&(n-=rr),l.style.visibility=n<ht.offsetLeft+ht.clientWidth?at:h}}var ii="pointer",ui="default",s="undefined",lr="function",h="visible",at="hidden",ar="hp_pgps",g="focus",d="click",yr="keydown",b="mousedown",yi="mouseup",rt="mouseover",bi="touchstart",si="hpsbact",iu="div",ru="dhplink",gi="block",it="none",oi=8,fr=500,nt=0,t=0,ei=0,y=null,n=[],lt=[],a,ft="url",tr="bot",u=_ge("bgDiv"),or=_ge("bgDivPortrait"),i=_ge("sh_igl"),f=_ge("sh_igr"),e=_ge("sh_igw"),w=0,p=_ge("sh_cp"),tt="sc_light",ot="sc_dark",st="javascript:void(0)",c=null,fi=!0,nu="ontouchstart"in _w,r=null,gt=null,k=_ge("sb_form_q"),nr=k&&k.parentNode,v,pt=_anim.fadeE(u,fr),ut,ht=_ge("sc_hdu"),l=_ge("dhp"),ti=_ge("dhplink"),ct=_ge("id_h"),rr=300,br=kr();if(i&&f&&(_w.hpPanoLoad=function(n){ni(n,!0)},!_w.g_IMVL)){typeof _w.g_IMVL!==s&&(_w.g_IMVL=1),sj_evt.bind("onHPHS",function(n){a=n[1]},1),k&&(sj_be(k,g,vt),sj_be(k,yr,vt),nr&&sj_be(nr,d,vt)),sj_evt.bind("onRBComplete",function(){var n=_w.sched;_w.g_hptse&&n&&n.schedule({ns:"H",task:function(){n.complete("H")}}),pr()},1),ht&&(l||ti)&&ct&&(sj_evt.bind(ru,hi,1),sj_be(_w,"resize",hi,!1));var er=new RegExp("[\\?&]ssd=([^&#]*)"),yt=er.exec(_w.location.href),di=1,ri;yt!=null&&yt[1]!=null&&(ri=yt[1].replace("_",""),di=oi),ir(0,di,function(r){function u(n){sb_st(sj_wf(ur,n),1),sj_ue(i,rt,u),sj_ue(f,rt,u),sj_ue(i,g,u),sj_ue(f,g,u)}var o,l,a,y,s,p,w;if(r){if(t=0,ri!=null)for(tu(),o=0;o<nt;o++)n[o].fullstartdate==ri&&(t=o);else dt(0,0);v=v||c.tooltips,sj_be(i,d,bt),sj_be(f,d,kt),i.firstChild.style.visibility=h,f.firstChild.style.visibility=h,l=_ge("sh_igf"),l&&(l.firstChild.style.visibility=h),a=_ge("sh_pl"),y=_ge("sh_ps"),et(),i.firstChild.className=n[t][tr]=="1"?tt:ot,n[t].pano?ni(n[t].pano,!0):n[t].vid&&(s=n[t].vid.dark,a.parentNode.className=s?"sh_pll":"sh_pld",y.parentNode.className=s?"sh_psl":"sh_psd",i.firstChild.className=s?tt:ot),p=function(i){sj_pd(i),t==0&&n&&n.length==1?u(sj_wf(bt,i)):bt(i)},w=function(i){sj_pd(i),t==0&&n&&n.length==1?u(sj_wf(kt,i)):kt(i)},nu&&(sj_be(i,bi,p),sj_be(f,bi,w)),sj_be(i,rt,u),sj_be(f,rt,u),sj_be(i,g,u),sj_be(f,g,u),e&&hpWall&&(_G.Mkt=="zh-CN"?sj_be(e,d,hpWall.dLFree):sj_be(e,d,hpWall.dL))}}),function(){var o="px",it="click",w="block",tt="none",p="height",y="HPTBD",n=400,v=35,nt=1,d=.5,b=_ge("sh_igf"),e=_ge("hp_sw_hdr"),t=e.style,a=_ge("sb_foot"),l=_ge("sb_form_q"),c=l&&l.parentNode,s=_ge("sh_fu"),f,u,r,i=!1;if(b&&e&&a&&c){var rt=function(){f=_anim.animE(e,p,0,v,{duration:n,unit:o}),u=_anim.animE(a,p,0,v,{duration:n,unit:o}),r=_anim.fadeE(c,n,n,d,nt),sj_be(b,it,et),sj_evt.bind(si,k)},ut=function(){t.display=tt,t.overflow=h,i=!0,sj_evt.fire(y)},ft=function(){t.overflow=h,i=!1,sj_evt.fire(y)},et=function(n){i?k():g(),sj_pd(n)},g=function(){i||(t.display=w,t.overflow=at,_w.bhptb&&bhptb.hide&&bhptb.hide(n),_w.bhppgb&&bhppgb.hide&&bhppgb.hide(n),_w.bhpnav&&bhpnav.hide&&bhpnav.hide(),f.revert(ut),u.revert(),r.down(),s.className="hpcSmall")},k=function(){i&&(t.display=w,t.overflow=at,_w.bhptb&&bhptb.show&&bhptb.show(n),_w.bhppgb&&bhppgb.show&&bhppgb.show(n),_w.bhpnav&&bhpnav.show&&bhpnav.show(),f.start(ft),u.start(),r.up(),s.className="hpcFull")};rt()}}()}};sj_evt.bind("onBgSet",ImgViewer,1),sj_evt.bind("onAjaxReady",ImgViewer,1)